<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- 新 Bootstrap4 核心 CSS 文件 -->
	<!-- <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css"> -->
	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.0/css/bootstrap.min.css">

	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<!-- <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script> -->
	<script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script>

	<!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
	<!-- <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script> -->
	<script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>

	<!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
	<!-- <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script> -->
	<script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>

	<!-- 剪贴板 -->
	<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>

	<script>
		var _hmt = _hmt || [];
		(function () {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?90b728e271c36bba7dbaf721120d177d";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>



</head>

<body class="my-3">
	<div class="container">
		<div class="row clearfix">
			<div class="col-12 column">
				<h3>
					<a href="https://www.youhou8.com/group/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91">Free V2ray/Trojan</a>
				</h3>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row clearfix">
			<div class="col-12 column">
				<div id="div1"></div>
				<!-- <div id="div2"></div> -->
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row clearfix">
			<div class="col-12 column">
				<div id="tips" class="my-3"></div>
			</div>
		</div>
	</div>
	<script language="javascript" type="text/javascript">

		function timestamp(url) {
			var getTimestamp = new Date().getTime();
			url = url + "&timestamp=" + getTimestamp
			return url;
		}

		function cors(url) {
			// use timestamp to disable cache
			url = timestamp("https://jsonp.afeld.me/?url=" + encodeURIComponent(url));
			// 自建高速cors api ，需要https，咕咕咕
			// url = timestamp("http://47.115.132.44/cors?url=" + url);
			return url;
		}

		function copyof(jspath) {
			console.log($(jspath)[0]);
			clipboard = new ClipboardJS(jspath, { text: function () { return $(jspath).text(); } });
			clipboard.on('success', function (e) {
				showTip("<strong>复制成功：</strong>" + e.text, "success");
				// console.info('Action:', e.action);
				// console.info('Text:', e.text);
				// console.info('Trigger:', e.trigger);
				console.info(e);
				// e.clearSelection();
			});

			clipboard.on('error', function (e) {
				// console.error('Action:', e.action);
				// console.info('Text:', e.text);
				// console.error('Trigger:', e.trigger);
				console.error(e);
				showTip("<strong>复制失败：</strong>" + JSON.stringify(e), "danger");

			});
			$(jspath).css("cursor", "pointer");
			return clipboard;
		}

		function showTip(msg, type, time) {
			if (type == "success") {
				if (time == undefined) {
					time = 1000;
				}
				$('#tips').append($(`<div class="alert alert-success"></div>`).append(msg).hide().fadeIn(200).delay(time).fadeOut(200, function () { this.remove() }));
			} else if (type == "danger") {
				if (time == undefined) {
					time = 5000;
				}
				$('#tips').append($(`<div class="alert alert-danger"></div>`).append(msg).hide().fadeIn(200).delay(time).fadeOut(200, function () { this.remove() }));
			} else {
				if (time == undefined) {
					time = 1500;
				}
				$('#tips').append($(`<div class="alert alert-info"></div>`).append(msg).hide().fadeIn(200).delay(time).fadeOut(200, function () { this.remove() }));
			}
		}

		function parseDom(arg) {
			var objE = document.createElement("div");
			objE.innerHTML = arg;
			// return objE.childNodes;
			return objE;
		};

		$(document).ready(function () {
			$('#div1').append($(`<div class="alert alert-info"></div>`).append("加载中..."));

			$("#div1").load(cors("https://www.zkq8.com/v2ray2_link.txt"), function (response, status, xhr) {

				// console.log(response);
				// console.log(status);
				console.log(xhr);
				console.log(parseDom(response));

				// $("#div1 > table").css("width", "100%").addClass("table table-sm table-bordered table-responsive-sm");
				$("#div1 > table").addClass("table table-bordered");

				console.group("remove tip");
				$("#div1 > p").each(function (i) {
					if ($(this).text().indexOf("恭喜你，你脚本已经是最新，每周一更新密码和端口") >= 0) {
						console.log($(this)[0]);
						$(this).remove();
					};
				});
				console.groupEnd();

				console.group("simplify title");
				type = $("#div1 > table > tbody > tr:nth-child(1) > th:nth-child(1)");
				if (type.text().indexOf("类型")) {
					type.text("类型");
					console.log(type.text());
				}
				server = $("#div1 > table > tbody > tr:nth-child(1) > th:nth-child(2)");
				console.log(server.text());
				if (server.text().indexOf("server address")) {
					server.text("server address");
					console.log(server.text());
				}
				password = $("#div1 > table > tbody > tr:nth-child(1) > th:nth-child(3)");
				console.log(password.text());
				if (password.text().indexOf("password")) {
					password.text("password");
					console.log(password.text());
				}
				port = $("#div1 > table > tbody > tr:nth-child(1) > th:nth-child(4)");
				console.log(port.text());
				if (port.text().indexOf("port")) {
					port.text("port");
					console.log(port.text());
				}
				console.groupEnd();

				for (var i = 2; i <= $("#div1 > table > tbody > tr").length; i++) {
					if ($("#div1 > table > tbody > tr:nth-child(" + i + ") > td:nth-child(1)").text().indexOf("trojan") >= 0) {
						// $("#div1 > table > tbody > tr:nth-child(" + i + ") > td:nth-child(1)").text("trojan");
						let server = "#div1 > table > tbody > tr:nth-child(" + i + ") > td:nth-child(2)";
						let password = "#div1 > table > tbody > tr:nth-child(" + i + ") > td:nth-child(3)";
						let port = "#div1 > table > tbody > tr:nth-child(" + i + ") > td:nth-child(4)";
						console.group("init copy of tr: " + i);
						// console.log($("#div1 > table > tbody > tr:nth-child("+i+")")[0]);
						copyof(server);
						copyof(password);
						copyof(port);
						console.groupEnd();
					}

					if ($("#div1 > table > tbody > tr:nth-child(" + i + ") > td:nth-child(1)").text().indexOf("暂无节点") >= 0) {
						console.group("remove tr: " + i);
						console.log($("#div1 > table > tbody > tr:nth-child(" + i + ")")[0]);
						$("#div1 > table > tbody > tr:nth-child(" + i + ")").remove();
						console.groupEnd();
					}

				}

				showTip("<strong>提示：</strong>点击可直接复制", "info");

			});


		});
	</script>
</body>


</html>